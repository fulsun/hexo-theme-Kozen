<!-- 文章顶部横幅图片 -->
<div class="relative w-full h-64 bg-gradient-to-r overflow-hidden">
    <!-- 背景图片 -->
     <!-- class 绝对定位，覆盖整个元素 -->
    <div class="absolute inset-0 bg-cover bg-center rounded-t-lg" style="background-image: url('<%- page.cover || '/images/default-cover.jpg' %>'); opacity: 0.5;"></div>
    <!-- 文章标题和信息 -->
    <div class="relative z-10 container mx-auto px-4 h-full flex flex-col justify-center">
        <h1 class="text-4xl font-bold text-balance mb-4 text-center"><%= page.title %></h1>
        <div class="flex justify-center items-center flex-wrap gap-4 text-balance/90 text-sm text-center">
            <span class="flex items-center gap-1">
                <i class="fa fa-calendar"></i> 发布于：<%- date(page.date, 'YYYY-MM-DD HH:mm:ss') %>
            </span>
            <% if (page.updated) { %>
                <span class="flex items-center gap-1">
                    <i class="fa fa-edit"></i> 更新于：<%- date(page.updated, 'YYYY-MM-DD HH:mm:ss') %>
                </span>
            <% } %>
            <% if (page.categories && page.categories.length > 0) { %>
                <span class="flex items-center gap-1">
                    <i class="fa fa-folder"></i> 分类：
                    <% page.categories.each(function(category, index) { %>
                        <a href="<%- url_for(category.path) %>" class="hover:underline"><%= category.name %></a><% if (index < page.categories.length - 1) { %>, <% } %>
                    <% }); %>
                </span>
            <% } %>
            <% if (page.tags && page.tags.length > 0) { %>
                <span class="flex items-center gap-1">
                    <i class="fa fa-tags"></i> 标签：
                    <% page.tags.each(function(tag, index) { %>
                        <a href="<%- url_for(tag.path) %>" class="hover:underline"><%= tag.name %></a><% if (index < page.tags.length - 1) { %>, <% } %>
                    <% }); %>
                </span>
            <% } %>
        </div>
    </div>
</div>

<!-- 文章主体内容 -->
<div class="py-8">
    <!-- 文章卡片 -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8 transform -translate-y-8">
        <!-- 文章标题 -->
        <!-- <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">
            <%= page.title %>
        </h2> -->
        <!-- 文章摘要 -->
        <!-- <div class="text-gray-600 mb-8 pb-4 border-b border-gray-200">
            <%- page.excerpt || page.content.substring(0, 200) %>...
        </div> -->
        <!-- 文章内容 -->
        <div class="post-content text-gray-700 leading-relaxed">
            <%- page.content %>
        </div>
        
        <!-- 为标题添加链接图标和复制链接功能，以及为代码块添加美化效果 -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // 为所有标题元素添加链接图标
                const headings = document.querySelectorAll('.post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6');
                
                headings.forEach(heading => {
                    // 确保标题有 ID
                    if (!heading.id) {
                        // 根据标题文本生成 ID
                        const id = heading.textContent.trim().toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
                        heading.id = id;
                    }
                    
                    // 创建链接图标元素
                    const anchor = document.createElement('a');
                    anchor.href = `#${heading.id}`;
                    anchor.className = 'header-anchor';
                    anchor.innerHTML = '<span class="fa fa-link text-base"></span>';
                    anchor.title = '复制链接';
                    
                    // 添加点击事件，复制链接到剪贴板并更新地址栏
                    anchor.addEventListener('click', function(e) {
                        e.preventDefault();
                        const url = window.location.origin + window.location.pathname + `#${heading.id}`;
                        
                        // 复制链接到剪贴板
                        navigator.clipboard.writeText(url).then(function() {
                            // 更新地址栏
                            window.location.hash = heading.id;
                            
                            // 显示复制成功提示
                            const originalText = anchor.innerHTML;
                            anchor.innerHTML = '✓';
                            
                            // 400毫秒后恢复原图标
                            setTimeout(function() {
                                anchor.innerHTML = originalText;
                            }, 400);
                        }).catch(function(err) {
                            console.error('无法复制链接: ', err);
                        });
                    });
                    
                    // 将链接图标添加到标题前
                    heading.insertBefore(anchor, heading.firstChild);
                });
                
                // 为代码块添加美化效果
                const highlightFigures = document.querySelectorAll('.post-content figure.highlight');
                
                highlightFigures.forEach((figure, index) => {
                    // 从 figure 的 class 中提取语言信息
                    let language = 'code';
                    const classList = figure.className;
                    const langMatch = classList.match(/highlight\s+(\w+)/);
                    if (langMatch) {
                        language = langMatch[1];
                    }
                    
                    // 创建包装器
                    const wrapper = document.createElement('div');
                    wrapper.className = 'highlight-wrap';
                    
                    // 创建代码头部
                    const codeHeader = document.createElement('div');
                    codeHeader.className = 'code-header';
                    
                    // 创建标题部分（包含圆点和语言）
                    const codeTitle = document.createElement('div');
                    codeTitle.className = 'code-title';
                    
                    // 创建圆点
                    const codeDots = document.createElement('div');
                    codeDots.className = 'code-dots';
                    
                    const redDot = document.createElement('div');
                    redDot.className = 'code-dot red';
                    
                    const yellowDot = document.createElement('div');
                    yellowDot.className = 'code-dot yellow';
                    
                    const greenDot = document.createElement('div');
                    greenDot.className = 'code-dot green';
                    
                    codeDots.appendChild(redDot);
                    codeDots.appendChild(yellowDot);
                    codeDots.appendChild(greenDot);
                    
                    const codeLanguage = document.createElement('span');
                    codeLanguage.className = 'code-language';
                    codeLanguage.textContent = language;
                    
                    codeTitle.appendChild(codeDots);
                    codeTitle.appendChild(codeLanguage);
                    
                    // 创建复制按钮
                    const copyButton = document.createElement('button');
                    copyButton.className = 'copy-button';
                    copyButton.textContent = 'COPY';
                    
                    // 添加复制功能
                    copyButton.addEventListener('click', function() {
                        // 获取所有代码行
                        const codeLines = figure.querySelectorAll('.code .line');
                        let code = '';
                        
                        codeLines.forEach(line => {
                            // 移除行内的语法高亮标签，只保留纯文本
                            const text = line.textContent;
                            code += text + '\n';
                        });
                        
                        navigator.clipboard.writeText(code).then(function() {
                            copyButton.textContent = 'COPIED';
                            copyButton.classList.add('copied');
                            
                            setTimeout(function() {
                                copyButton.textContent = 'COPY';
                                copyButton.classList.remove('copied');
                            }, 2000);
                        }).catch(function(err) {
                            console.error('无法复制代码: ', err);
                        });
                    });
                    
                    // 组装头部
                    codeHeader.appendChild(codeTitle);
                    codeHeader.appendChild(copyButton);
                    
                    // 替换 figure 元素
                    figure.parentNode.insertBefore(wrapper, figure);
                    wrapper.appendChild(codeHeader);
                    wrapper.appendChild(figure);
                    
                    // 为表格添加样式
                    const table = figure.querySelector('table');
                    if (table) {
                        table.style.margin = '0';
                        table.style.borderCollapse = 'collapse';
                        table.style.width = '100%';
                    }
                    
                    // 为代码单元格添加样式
                    const codeCell = figure.querySelector('.code');
                    if (codeCell) {
                        codeCell.style.padding = '0';
                        codeCell.style.backgroundColor = '#1f2937';
                    }
                    
                    // 为行号单元格添加样式
                    const gutterCell = figure.querySelector('.gutter');
                    if (gutterCell) {
                        gutterCell.style.padding = '0';
                        gutterCell.style.backgroundColor = '#1f2937';
                        gutterCell.style.borderRight = '1px solid #374151';
                        gutterCell.style.width = '40px';
                    }
                    
                    // 为 pre 元素添加样式
                    const preElements = figure.querySelectorAll('pre');
                    preElements.forEach(pre => {
                        pre.style.margin = '0';
                        pre.style.borderRadius = '0';
                        pre.style.backgroundColor = '#1f2937';
                        pre.style.color = '#f3f4f6';
                    });
                    
                    // 为代码行添加样式
                    const codeLines = figure.querySelectorAll('.line');
                    codeLines.forEach(line => {
                        line.style.padding = '0 12px';
                        line.style.lineHeight = '1.5';
                    });
                    
                    // 确保语法高亮样式能够正常显示
                    const keywordElements = figure.querySelectorAll('.keyword');
                    keywordElements.forEach(el => {
                        el.style.color = '#60a5fa';
                    });
                    
                    const titleElements = figure.querySelectorAll('.title');
                    titleElements.forEach(el => {
                        el.style.color = '#34d399';
                    });
                    
                    const stringElements = figure.querySelectorAll('.string');
                    stringElements.forEach(el => {
                        el.style.color = '#fbbf24';
                    });
                });
            });
        </script>
    </div>
</div>